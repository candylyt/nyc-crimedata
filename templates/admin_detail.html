<html>
  <style>
    body { font-family: arial; font-size: 15pt; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .title { font-size:28px; font-weight:bold; }
    .tabs { display:flex; gap:8px; align-items:center; }
    .tabs a { text-decoration:none; padding:6px 10px; border:1px solid #000; border-radius:4px; color:#000; }
    .tabs a.active { background:#000; color:#fff; }
     .btn-sky {
        background:#e6f2ff; border:1px solid #9cc9ff; color:#0b4a8b;
        border-radius:6px; text-decoration:none; padding:6px 10px;
      }
      .btn-sky:hover { background:#d8ecff; border-color:#86bfff; }

      /* new: small size variant */
      .btn-sm { font-size:14px; padding:4px 10px; line-height:1.2; }

      /* new: right-side column so Back sits beneath the tabs */
      .right-stack { display:flex; flex-direction:column; align-items:flex-end; gap:6px; }

    /* cards/sections */
    .card { border:1px solid #ddd; border-radius:8px; padding:14px; margin-top:14px; }
    .card h3 { margin:0 0 8px; }

    .kv p { margin: 6px 0; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    /* compact controls */
    select.sm, input.sm, button.sm { font-size:14px; padding:4px 8px; }
    select.sm { min-width:110px; }
    .wide { width:100%; }

    /* danger button */
    .btn-danger {
      font-weight:700; color:#b00020; border:1px solid #b00020; background:transparent;
      padding:6px 10px; border-radius:4px; cursor:pointer;
    }

    /* lists */
    ul.clean { margin:0; padding-left:20px; }
    li.item { margin:8px 0; }

    /* small help text */
    .help { font-size:12px; color:#666; margin-top:6px; }

    /* two-column grid for add forms on wide screens */
    .grid-2 { display:grid; grid-template-columns: repeat(2, minmax(320px, 1fr)); gap:12px; }
    @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }

    /* inline mini-form for arrest toggle */
    .inline-form { display:inline-flex; gap:6px; align-items:center; margin-left:10px; }
    .label { font-size:14px; color:#333; }
  </style>

  <body>
    <!-- header -->
    <div class="top-bar">
      <div class="title">NYC Crime Data</div>
      <div class="right-stack">
        <div class="tabs">
          <a href="{{ url_for('index') }}">General User</a>
          <a href="{{ url_for('admin_index') }}" class="active">Administrator</a>
        </div>
        <a class="btn-sky btn-sm" href="{{ url_for('admin_index') }}">← Back</a>
      </div>
    </div>
    <!-- flashes -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <style>
          .flash { padding:8px 12px; border-radius:6px; margin:10px 0; }
          .flash.success { background:#eef9f0; border:1px solid #bfe3c6; color:#1a7f37; }
          .flash.error   { background:#fff3f3; border:1px solid #f1c0c0; color:#b00020; }
          .flash.info    { background:#eaf4ff; border:1px solid #9cc9ff; color:#0b4a8b; }
        </style>
        {% for category, msg in messages %}
          <div class="flash {{ category }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- incident header + delete -->
    <div class="row" style="margin-bottom:6px;">
      <h2 style="margin:0;">Incident #{{ incident.incident_id }}</h2>
      <form method="post" onsubmit="return confirm('Delete this incident as a false report?');">
        <input type="hidden" name="action" value="delete_incident">
        <button type="submit" class="btn-danger">Delete (false report)</button>
      </form>
    </div>

    <!-- Incident facts + status -->
    <div class="card">
      <h3>Incident</h3>
      <div class="kv">
        <p><strong>Occurred Date:</strong> {{ incident.occurred_date }}</p>
        <p><strong>Status:</strong> {{ incident.status }}</p>
        <p><strong>Crime Type:</strong> {{ incident.crime_type }} ({{ incident.category }})</p>
        <p><strong>Severity:</strong> {{ incident.severity }}</p>
        <p><strong>Borough:</strong> {{ incident.borough }} {{ incident.postal_code }}</p>
        <p><strong>Jurisdiction:</strong> {{ incident.jurisdiction }}</p>
        <p><strong>Description:</strong> {{ incident.description or '(no details)' }}</p>
      </div>

      <form method="post" class="row" style="margin-top:10px;">
        <input type="hidden" name="action" value="update_status">
        <label class="label">Update status:</label>
        <select name="new_status" class="sm">
          <option value="Open"  {% if incident.status=='Open' %}selected{% endif %}>Open</option>
          <option value="Closed" {% if incident.status=='Closed' %}selected{% endif %}>Closed</option>
        </select>
        <button type="submit" class="sm">Save</button>
      </form>
    </div>

    <div class="card">
      <h3>Edit Description</h3>
      <form method="post">
        <input type="hidden" name="action" value="update_description">
        <textarea name="incident_details" rows="3" style="width:100%">{{ incident.description or '' }}</textarea>
        <div style="display:flex; gap:10px; align-items:center; margin-top:8px;">
          <button type="submit" class="btn-sky btn-sm">Save Description</button>
          <small>Keep it factual; this shows on admin views.</small>
        </div>
      </form>
    </div>




    <!-- Suspects -->
    <div class="card">
      <h3>Suspects</h3>
      {% if suspects %}
        <ul class="clean">
          {% for s in suspects %}
            <li class="item" style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee;">
              <div style="margin-bottom: 6px;">
                <strong>#{{ s.suspect_id }}</strong> — {{ s.gender or '?' }}/{{ s.race or '?' }}, {{ s.age_grp or '?' }},
                Arrested: <strong>{{ 'Yes' if s.arrest_status else 'No' }}</strong>
              </div>
              
              <!-- Weapons display and edit -->
              <div style="margin-bottom: 6px;">
                <strong>Weapons:</strong> 
                {% if s.weapons %}
                  {{ s.weapons | join(', ') }}
                {% else %}
                  <em>(none)</em>
                {% endif %}
                <form method="post" class="inline-form" style="margin-left: 10px;">
                  <input type="hidden" name="action" value="update_suspect_weapons">
                  <input type="hidden" name="suspect_id" value="{{ s.suspect_id }}">
                  <input type="text" name="weapons" placeholder="e.g., knife, gun" 
                         value="{{ s.weapons | join(', ') if s.weapons else '' }}" 
                         class="sm" style="min-width: 200px;">
                  <button type="submit" class="sm">Update Weapons</button>
                </form>
              </div>

              <!-- compact arrest toggle -->
              <form method="post" class="inline-form">
                <input type="hidden" name="action" value="update_suspect_arrest">
                <input type="hidden" name="suspect_id" value="{{ s.suspect_id }}">
                <span class="label">Arrested?</span>
                <select name="arrest_status" class="sm">
                  <option value="Yes" {% if s.arrest_status %}selected{% endif %}>Yes</option>
                  <option value="No"  {% if not s.arrest_status %}selected{% endif %}>No</option>
                </select>
                <button type="submit" class="sm">Save</button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="help">(No suspects recorded)</p>
      {% endif %}

      <div class="grid-2" style="margin-top:10px;">
        <div>
          <h4 style="margin:0 0 6px;">Add Suspect</h4>
          <form method="post">
            <input type="hidden" name="action" value="add_suspect">
            <div class="row" style="margin-bottom:8px;">
              <label class="label">Gender</label>
              <select name="s_gender" class="sm">
                <option value="">(select)</option>
                <option>Female</option>
                <option>Male</option>
              </select>

              <label class="label">Race</label>
              <select name="s_race" class="sm" style="min-width:220px;">
                <option value="">(optional)</option>
                <option>BLACK</option>
                <option>WHITE</option>
                <option>WHITE HISPANIC</option>
                <option>BLACK HISPANIC</option>
                <option>ASIAN / PACIFIC ISLANDER</option>
                <option>AMERICAN INDIAN/ALASKAN NATIVE</option>
              </select>
            </div>

            <div class="row" style="margin-bottom:8px;">
              <label class="label">Age Group</label>
              <select name="s_age_grp" class="sm">
                <option value="">(select)</option>
                <option>&lt;18</option>
                <option>18-24</option>
                <option>25-44</option>
                <option>45-64</option>
                <option>65+</option>
              </select>

              <label class="label">Arrest</label>
              <select name="s_arrest" class="sm">
                <option value="No">No</option>
                <option value="Yes">Yes</option>
              </select>
            </div>

            <button type="submit" class="sm">Add Suspect</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Victims -->
    <div class="card">
      <h3>Victims</h3>
      {% if victims %}
        <ul class="clean">
          {% for v in victims %}
            <li class="item">
              <strong>#{{ v.victim_id }}</strong> — {{ v.gender or '?' }}/{{ v.race or '?' }},
              {{ v.age_grp or '?' }}, Injury: {{ v.injury_severity or 'Unknown' }}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="help">(No victims recorded)</p>
      {% endif %}

      <div class="grid-2" style="margin-top:10px;">
        <div>
          <h4 style="margin:0 0 6px;">Add Victim</h4>
          <form method="post">
            <input type="hidden" name="action" value="add_victim">
            <div class="row" style="margin-bottom:8px;">
              <label class="label">Gender</label>
              <select name="v_gender" class="sm">
                <option value="">(select)</option>
                <option>Female</option>
                <option>Male</option>
              </select>

              <label class="label">Race</label>
              <select name="v_race" class="sm" style="min-width:220px;">
                <option value="">(optional)</option>
                <option>BLACK</option>
                <option>WHITE</option>
                <option>WHITE HISPANIC</option>
                <option>BLACK HISPANIC</option>
                <option>ASIAN / PACIFIC ISLANDER</option>
                <option>AMERICAN INDIAN/ALASKAN NATIVE</option>
              </select>
            </div>

            <div class="row" style="margin-bottom:8px;">
              <label class="label">Age Group</label>
              <select name="v_age_grp" class="sm">
                <option value="">(select)</option>
                <option>&lt;18</option>
                <option>18-24</option>
                <option>25-44</option>
                <option>45-64</option>
                <option>65+</option>
              </select>

              <label class="label">Injury Severity</label>
              <select name="v_injury" class="sm">
                <option>None</option>
                <option>Minor</option>
                <option>Severe</option>
                <option>Fatal</option>
              </select>
            </div>

            <button type="submit" class="sm">Add Victim</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Suspect Clues (Full-text search) -->
    <div class="card">
      <h3>Suspect Clues (Full-text Search)</h3>
      <p class="help">Rich narrative descriptions (e.g., clothing, tattoos, speech patterns) for full-text search.</p>
      
      {% if suspect_clues %}
        <ul class="clean">
          {% for clue in suspect_clues %}
            <li class="item" style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee;">
              <div style="margin-bottom: 6px;">
                <strong>Clue #{{ clue.clue_id }}</strong> (Suspect #{{ clue.suspect_id }})
              </div>
              <div style="margin-bottom: 6px;">
                <strong>Text:</strong> {{ clue.clue_text }}
              </div>
              <form method="post" style="display: inline-block; margin-right: 8px;">
                <input type="hidden" name="action" value="update_suspect_clue">
                <input type="hidden" name="clue_id" value="{{ clue.clue_id }}">
                <textarea name="clue_text" rows="2" style="width: 400px; font-size: 14px;">{{ clue.clue_text }}</textarea>
                <button type="submit" class="sm">Update</button>
              </form>
              <form method="post" style="display: inline-block;" onsubmit="return confirm('Delete this clue?');">
                <input type="hidden" name="action" value="delete_suspect_clue">
                <input type="hidden" name="clue_id" value="{{ clue.clue_id }}">
                <button type="submit" class="sm btn-danger">Delete</button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="help">(No clues recorded)</p>
      {% endif %}

      <div style="margin-top: 10px;">
        <h4 style="margin: 0 0 6px;">Add Clue</h4>
        <form method="post">
          <input type="hidden" name="action" value="add_suspect_clue">
          <div class="row" style="margin-bottom: 8px;">
            <label class="label">Suspect:</label>
            <select name="suspect_id" class="sm" required>
              <option value="">(select suspect)</option>
              {% for s in suspects %}
                <option value="{{ s.suspect_id }}">Suspect #{{ s.suspect_id }}</option>
              {% endfor %}
            </select>
          </div>
          <div style="margin-bottom: 8px;">
            <label class="label">Clue Text:</label>
            <textarea name="clue_text" rows="3" style="width: 100%; font-size: 14px;" 
                      placeholder="e.g., Wearing red hoodie, has dragon tattoo on left arm, speaks with Brooklyn accent" required></textarea>
          </div>
          <button type="submit" class="sm">Add Clue</button>
        </form>
      </div>
    </div>
  </body>
</html>
