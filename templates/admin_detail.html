<html>
  <style>
    body { font-family: arial; font-size: 15pt; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .title { font-size:28px; font-weight:bold; }
    .tabs a { margin-left:8px; text-decoration:none; padding:6px 10px; border:1px solid #000; border-radius:4px; color:#000; }
    .tabs a.active { background:#000; color:#fff; }
    .kv p { margin: 6px 0; }
    .section { margin-top: 18px; }
    button { padding:6px 10px; }

    /* header row for title + delete */
    .header-row { display:flex; align-items:center; gap:12px; }
    .header-row h2 { margin:0; }
    .btn-danger {
      font-weight: 700;
      color: #b00020;
      border: 1px solid #b00020;
      background: transparent;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .inline-form { display:inline; margin-left:10px; }
  </style>
  <body>
    <!-- header tabs -->
    <div class="top-bar">
      <div class="title">NYC Crime Data</div>
      <div class="tabs">
        <a href="{{ url_for('index') }}">General User</a>
        <a href="{{ url_for('admin_index') }}" class="active">Administrator</a>
      </div>
    </div>

    <!-- Incident title + Delete button -->
    <div class="header-row">
      <h2>Incident #{{ incident.incident_id }}</h2>
      <form method="post" onsubmit="return confirm('Delete this incident?');">
        <input type="hidden" name="action" value="delete_incident">
        <button type="submit" class="btn-danger">Delete (false report)</button>
      </form>
    </div>

    <div class="kv">
      <p><strong>Occurred Date:</strong> {{ incident.occurred_date }}</p>
      <p><strong>Status:</strong> {{ incident.status }}</p>
      <p><strong>Crime Type:</strong> {{ incident.crime_type }} ({{ incident.category }})</p>
      <p><strong>Severity:</strong> {{ incident.severity }}</p>
      <p><strong>Borough:</strong> {{ incident.borough }} {{ incident.postal_code }}</p>
      <p><strong>Jurisdiction:</strong> {{ incident.jurisdiction }}</p>
      <p><strong>Description:</strong> {{ incident.description or '(no details)' }}</p>
    </div>

    <!-- Status update -->
    <div class="section">
      <form method="post" style="display:inline-block; margin-right:12px;">
        <input type="hidden" name="action" value="update_status">
        <label>Update status:</label>
        <select name="new_status">
          <option value="Open"  {% if incident.status=='Open' %}selected{% endif %}>Open</option>
          <option value="Closed" {% if incident.status=='Closed' %}selected{% endif %}>Closed</option>
        </select>
        <button type="submit">Save</button>
      </form>
    </div>

    <!-- Suspects -->
    <div class="section">
      <h3>Suspects</h3>
      {% if suspects %}
        <ul>
        {% for s in suspects %}
          <li>
            #{{ s.suspect_id }} — {{ s.gender or '?' }}/{{ s.race or '?' }}, {{ s.age_grp or '?' }},
            Arrested: {{ 'Yes' if s.arrest_status else 'No' }}
            <form method="post" class="inline-form">
              <input type="hidden" name="action" value="update_suspect_arrest">
              <input type="hidden" name="suspect_id" value="{{ s.suspect_id }}">
              <select name="arrest_status">
                <option value="Yes" {% if s.arrest_status %}selected{% endif %}>Yes</option>
                <option value="No"  {% if not s.arrest_status %}selected{% endif %}>No</option>
              </select>
              <button type="submit">Save</button>
            </form>
          </li>
        {% endfor %}
        </ul>
      {% else %}
        <p>(none)</p>
      {% endif %}
    </div>

    <!-- Victims -->
    <div class="section">
      <h3>Victims</h3>
      {% if victims %}
        <ul>
        {% for v in victims %}
          <li>#{{ v.victim_id }} — {{ v.gender or '?' }}/{{ v.race or '?' }},
              {{ v.age_grp or '?' }}, Injury: {{ v.injury_severity or 'Unknown' }}</li>
        {% endfor %}
        </ul>
      {% else %}
        <p>(none)</p>
      {% endif %}
    </div>

    <p class="section"><a href="{{ url_for('admin_index') }}">← Back to admin list</a></p>
  </body>
</html>
