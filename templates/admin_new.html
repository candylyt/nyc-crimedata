<html>
  <style>
    body { font-family: arial; font-size: 15pt; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .title { font-size:28px; font-weight:bold; }
    .tabs a { margin-left:8px; text-decoration:none; padding:6px 10px; border:1px solid #000; border-radius:4px; color:#000; }
    .tabs a.active { background:#000; color:#fff; }
    form .grid { display:grid; grid-template-columns: repeat(2, minmax(280px, 1fr)); gap:12px; }
    fieldset { border:1px solid #ddd; border-radius:6px; padding:10px; }
    legend { color:#555; font-size:0.95rem; }
    label { display:block; font-size:0.9rem; margin-bottom:4px; }
    input[type="text"], input[type="date"], select, textarea { width:100%; padding:6px 8px; }
    textarea { min-height: 80px; }
    .actions { margin-top:16px; }
    .actions button { padding:8px 12px; }
    .err { background:#fff3f3; border:1px solid #f1c0c0; color:#b00020; padding:8px; border-radius:6px; margin-bottom:12px; }
    .subgrid { display:grid; grid-template-columns: repeat(4, minmax(160px, 1fr)); gap:10px; }

  </style>
  <body>
    <div class="top-bar">
      <div class="title">NYC Crime Data</div>
      <div class="tabs">
        <a href="{{ url_for('index') }}">General User</a>
        <a href="{{ url_for('admin_index') }}" class="active">Administrator</a>
      </div>
    </div>

    <h2>Create Incident</h2>

    {% if errors %}
      <div class="err">
        <ul>
          {% for e in errors %}<li>{{ e }}</li>{% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post">
      <div class="grid">
        <!-- Occurred Date (single) -->
        <div>
          <label>Occurred Date</label>
          <input type="date" name="occurred_date"
                 value="{{ (form.occurred_date if form else '') }}" required />
        </div>

        <div>
          <label>Status</label>
          <select name="status">
            <option value="Open"  {% if form and form.status=='Open' %}selected{% endif %}>Open</option>
            <option value="Closed" {% if form and form.status=='Closed' %}selected{% endif %}>Closed</option>
          </select>
        </div>

        <div>
        <label>Jurisdiction</label>
        <select name="jur_id" required>
          <option value="">-- Select --</option>
          {% for j in jurs %}
            <option value="{{ j.jur_id }}"
              {% if form and (form.jur_id == j.jur_id|string) %}selected{% endif %}>
              {{ j.description }} ({{ j.display_id }})
            </option>
          {% endfor %}
        </select>
        </div>

        <div>
          <label>Crime Type</label>
          <select name="crime_type_id" required>
            <option value="">-- Select --</option>
            {% for c in crimes %}
              <option value="{{ c.crime_type_id }}"
                {% if form and form.crime_type_id==c.crime_type_id|string %}selected{% endif %}>
                {{ c.category }} Â· {{ c.crime_type }} ({{ c.severity }})
              </option>
            {% endfor %}
          </select>
        </div>

        <div style="grid-column:1/-1;">
          <label>Incident Details</label>
          <textarea name="incident_details">{{ (form.incident_details if form else '') }}</textarea>
        </div>
      </div>

      <fieldset style="margin-top:14px;">
        <legend>Address</legend>
        <div class="subgrid">
          <div>
            <label>Borough</label>
            <select name="borough" required>
              {% set boros = ["MANHATTAN","BROOKLYN","QUEENS","BRONX","STATEN ISLAND"] %}
              <option value="">-- Select --</option>
              {% for b in boros %}
                <option value="{{ b }}" {% if form and form.borough==b %}selected{% endif %}>{{ b }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label>Postal Code</label>
            <input type="text" name="postal_code" value="{{ (form.postal_code if form else '') }}" required />
          </div>
          <div>
            <label>Latitude</label>
            <input type="text" name="latitude" value="{{ (form.latitude if form else '') }}" required />
          </div>
          <div>
            <label>Longitude</label>
            <input type="text" name="longitude" value="{{ (form.longitude if form else '') }}" required />
          </div>
        </div>
      </fieldset>

      <fieldset style="margin-top:14px;">
        <legend>Suspects (optional, up to 3)</legend>
        {% for i in [1,2,3] %}
          <div class="subgrid" style="margin-bottom:8px;">
            <div>
              <label>Gender</label>
              <select name="suspect{{i}}_gender">
                <option value=""></option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
              </select>
            </div>
            <div>
              <label>Race</label>
              <select name="suspect{{i}}_race">
                <option value=""></option>
                <option value="White">White</option>
                <option value="Black">Black</option>
                <option value="Asian">Asian</option>
                <option value="Hispanic">Hispanic</option>
                <option value="Native American">Native American</option>
                <option value="Pacific Islander">Pacific Islander</option>
                <option value="Other/Unknown">Other/Unknown</option>
              </select>
            </div>
            <div>
              <label>Age Group</label>
              <select name="suspect{{i}}_age_grp">
                <option value=""></option>
                <option value="<18">&lt;18</option>
                <option value="18-24">18-24</option>
                <option value="25-44">25-44</option>
                <option value="45-64">45-64</option>
                <option value="65+">65+</option>
              </select>
            </div>
            <div>
              <label>Arrested</label>
              <input type="checkbox" name="suspect{{i}}_arrest_status" />
            </div>
          </div>
        {% endfor %}
      </fieldset>

      <fieldset style="margin-top:14px;">
        <legend>Victims (optional, up to 3)</legend>
        {% for i in [1,2,3] %}
          <div class="subgrid" style="margin-bottom:8px;">
            <div>
              <label>Gender</label>
              <select name="victim{{i}}_gender">
                <option value=""></option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
              </select>
            </div>
            <div>
              <label>Race</label>
              <select name="victim{{i}}_race">
                <option value=""></option>
                <option value="White">White</option>
                <option value="Black">Black</option>
                <option value="Asian">Asian</option>
                <option value="Hispanic">Hispanic</option>
                <option value="Native American">Native American</option>
                <option value="Pacific Islander">Pacific Islander</option>
                <option value="Other/Unknown">Other/Unknown</option>
              </select>
            </div>
            <div>
              <label>Age Group</label>
              <select name="victim{{i}}_age_grp">
                <option value=""></option>
                <option value="<18">&lt;18</option>
                <option value="18-24">18-24</option>
                <option value="25-44">25-44</option>
                <option value="45-64">45-64</option>
                <option value="65+">65+</option>
              </select>
            </div>
            <div>
              <label>Injury Severity</label>
              <select name="victim{{i}}_injury">
                <option value=""></option>
                <option value="None">None</option>
                <option value="Minor">Minor</option>
                <option value="Severe">Severe</option>
                <option value="Fatal">Fatal</option>
              </select>
            </div>
          </div>
        {% endfor %}
      </fieldset>

      <div class="actions">
        <button type="submit">Create Incident</button>
        <a href="{{ url_for('admin_index') }}" style="margin-left:10px;">Cancel</a>
      </div>
    </form>
  </body>
</html>
